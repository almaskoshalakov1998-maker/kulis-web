<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö“Ø–ª—ñ—Å ‚Äî 1√ó1</title>
  <style>
    body { background:#0a7c2f; color:#fff; font-family:system-ui, Arial, sans-serif; margin:0; }
    header { text-align:center; padding:18px 12px; background:#085e24; }
    main { max-width:900px; margin:0 auto; padding:16px; }
    .controls { text-align:center; margin:10px 0 18px; }
    button { background:#ffd84a; border:none; padding:10px 16px; border-radius:8px; font-weight:700; cursor:pointer; }
    #table { background:#0c6c29; border:2px solid #fff; border-radius:12px; padding:16px; display:none; }
    .row { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; }
    .box { flex:1 1 280px; background:#0f7a30; border:1px solid #ffffff33; border-radius:10px; padding:12px; }
    h3 { margin:6px 0 10px; font-size:16px; }
    .hand { display:flex; flex-wrap:wrap; gap:8px; }
    .card {
      display:inline-flex; align-items:center; justify-content:center;
      width:60px; height:84px; background:#fff; color:#000; border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,.25); font-weight:700; cursor:pointer; user-select:none;
      border:2px solid transparent;
    }
    .card.hide { background:#173a1f; color:#173a1f; }
    .card.disabled { pointer-events:none; opacity:.6; }
    .info { font-size:14px; opacity:.9; }
    #log { background:#083d1a; border-radius:8px; padding:10px; height:180px; overflow:auto; font-size:14px; }
    .tag { display:inline-block; padding:2px 6px; border-radius:6px; background:#104b21; border:1px solid #ffffff33; margin-left:6px; font-size:12px; }
    .pill { display:inline-block; padding:2px 6px; border-radius:999px; background:#ffd84a; color:#000; font-weight:700; margin-left:6px; }
  </style>
</head>
<body>
  <header>
    <h1>–ö“Ø–ª—ñ—Å ‚Äî –¥—É—ç–ª—å 1√ó1</h1>
  </header>
  <main>
    <div class="controls">
      <button onclick="startGame()">–ù–æ–≤–∞—è —Ä–∞–∑–¥–∞—á–∞</button>
    </div>

    <div id="table">
      <div class="row">
        <div class="box">
          <h3>–ö–æ–∑—ã—Ä—å: <span id="trump"></span>
            <span class="tag">–ª–µ–≤–∞—è: <span id="leftPalka"></span></span>
            <span class="tag">–ø—Ä–∞–≤–∞—è: <span id="rightPalka"></span></span>
          </h3>
          <div class="info" id="status"></div>
        </div>
        <div class="box">
          <h3>–°—Ç–æ–ª</h3>
          <div class="info" id="battle">–ü—É—Å—Ç–æ</div>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div class="box">
          <h3>–¢–≤–æ–∏ –∫–∞—Ä—Ç—ã <span class="pill" id="youCount">0</span></h3>
          <div class="hand" id="playerHand"></div>
        </div>
        <div class="box">
          <h3>–ö–∞—Ä—Ç—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ <span class="pill" id="botCount">0</span></h3>
          <div class="hand" id="botHand"></div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <h3>–ñ—É—Ä–Ω–∞–ª</h3>
        <div id="log"></div>
      </div>
    </div>
  </main>

  <script>
    // ===== –ö–æ–ª–æ–¥–∞ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã =====
    const RANKS = ["7","9","10","J","Q","K","A"];
    const SUITS = ["‚ô†","‚ô£","‚ô•","‚ô¶"]; // –ø–∞—Ä—ã: ‚ô†‚Üî‚ô£, ‚ô•‚Üî‚ô¶
    const NON_TRUMP_ORDER = {"7":0,"9":1,"10":2,"J":3,"Q":4,"K":5,"A":6};
    const PAIR = {"‚ô†":"‚ô£","‚ô£":"‚ô†","‚ô•":"‚ô¶","‚ô¶":"‚ô•"};

    const CARD_VALUES = {"7":7,"9":9,"10":10,"J":10,"Q":10,"K":10,"A":11};

    function makeDeck(){
      const d=[]; for(const s of SUITS) for(const r of RANKS) d.push(r+s); return d;
    }
    function leftPalka(tr){ return "7"+PAIR[tr]; }
    function rightPalka(tr){ return "7"+tr; }
    function isLeft(c,tr){ return c===leftPalka(tr); }
    function isRight(c,tr){ return c===rightPalka(tr); }
    function isTrump(c,tr){ return c.slice(-1)===tr || isLeft(c,tr); }

    function trumpPower(c,tr){
      if(!isTrump(c,tr)) return -1;
      const r=c.slice(0,-1), s=c.slice(-1);
      if(s===tr && r==="A") return 8;           // –∫–æ–∑—ã—Ä–Ω—ã–π —Ç—É–∑ ‚Äî —Å—Ç–∞—Ä—à–∏–π
      if(isRight(c,tr))      return 7;          // –ø—Ä–∞–≤–∞—è –ø–∞–ª–∫–∞
      if(isLeft(c,tr))       return 6;          // –ª–µ–≤–∞—è –ø–∞–ª–∫–∞
      const map={"K":5,"Q":4,"J":3,"10":2,"9":1,"7":0};
      return map[r] ?? 0;
    }

    function canBeat(attack, defend, tr){
      // –ù–µ–∫–æ–∑—ã—Ä—å –±—å—ë—Ç—Å—è —Å—Ç–∞—Ä—à–µ–π —Ç–æ–π –∂–µ –º–∞—Å—Ç–∏ –ò–õ–ò –ª—é–±—ã–º –∫–æ–∑—ã—Ä–µ–º.
      const aSuit = attack.slice(-1), dSuit = defend.slice(-1);
      const aTrump = isTrump(attack,tr), dTrump = isTrump(defend,tr);
      if(!aTrump && dTrump) return true;
      if(aTrump && dTrump)  return trumpPower(defend,tr) > trumpPower(attack,tr);
      if(aSuit===dSuit && !aTrump) return NON_TRUMP_ORDER[defend.slice(0,-1)] > NON_TRUMP_ORDER[attack.slice(0,-1)];
      return false;
    }

    function kulisCardPoints(c,tr){
      if(isLeft(c,tr) || isRight(c,tr)) return 10.5;
      return CARD_VALUES[c.slice(0,-1)];
    }

    function detectKulis(hand,tr){
      const ranks = hand.map(c=>c.slice(0,-1));
      const suits = hand.map(c=>c.slice(-1));
      const hasL = hand.includes(leftPalka(tr));
      const hasR = hand.includes(rightPalka(tr));
      const aces = ranks.filter(r=>r==="A").length;

      // "—Ç—Ä–∏ —Ç—É–∑–∞": AAA, AA+–ª–µ–≤–∞—è, A+–ª–µ–≤–∞—è+–ø—Ä–∞–≤–∞—è
      if(aces===3) return {exists:true, tier:4, pts:33, hasR:hasR, hasL:hasL, kind:"AAA"};
      if(aces===2 && hasL) return {exists:true, tier:4, pts:33, hasR:hasR, hasL:true, kind:"AA+L"};
      if(aces===1 && hasL && hasR) return {exists:true, tier:4, pts:33, hasR:true, hasL:true, kind:"A+L+R"};

      // "—Ç—Ä–∏ —Å–µ–º—ë—Ä–∫–∏"
      if(ranks.every(r=>r==="7")){
        const pts = hand.reduce((s,c)=>s+kulisCardPoints(c,tr),0);
        return {exists:true, tier:3, pts:pts, hasR:hasR, hasL:hasL, kind:"777"};
      }

      // 3 –æ–¥–Ω–æ–π –º–∞—Å—Ç–∏
      const suitCounts = {};
      for(const s of suits) suitCounts[s]=(suitCounts[s]||0)+1;
      const monoSuit = Object.entries(suitCounts).find(([s,cnt])=>cnt===3)?.[0];
      if(monoSuit){
        const pts = hand.reduce((s,c)=>s+kulisCardPoints(c,tr),0);
        const isTrumpK = (monoSuit===tr);
        return {exists:true, tier: isTrumpK?2:1, pts:pts, hasR:hasR, hasL:hasL, suitRef:monoSuit, kind:"3-same-suit"};
      }

      // 2 –æ–¥–Ω–æ–π –º–∞—Å—Ç–∏ + –ø–∞–ª–∫–∞
      const pairSuit = Object.entries(suitCounts).find(([s,cnt])=>cnt===2)?.[0];
      if(pairSuit && (hasL || hasR)){
        const pts = hand.reduce((s,c)=>s+kulisCardPoints(c,tr),0);
        const isTrumpK = (pairSuit===tr);
        return {exists:true, tier: isTrumpK?2:1, pts:pts, hasR:hasR, hasL:hasL, suitRef:pairSuit, kind:"2-same+palka"};
      }

      return {exists:false, tier:0, pts:0, hasR:hasR, hasL:hasL, kind:"none"};
    }

    // compare: 1 –µ—Å–ª–∏ a>b, -1 –µ—Å–ª–∏ a<b, 0 –µ—Å–ª–∏ —Ä–∞–≤–Ω—ã
    function compareKulis(a,b){
      if(a.tier!==b.tier) return a.tier>b.tier?1:-1;
      if(a.tier===0) return 0;
      if(a.pts!==b.pts) return a.pts>b.pts?1:-1;
      // –ø—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –æ—á–∫–æ–≤: —É –∫–æ–≥–æ –ø—Ä–∞–≤–∞—è –ø–∞–ª–∫–∞ ‚Äî —Ç–æ—Ç —Å—Ç–∞—Ä—à–µ (–µ—Å–ª–∏ —É –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∞—è, —É –¥—Ä—É–≥–æ–≥–æ —Ç–æ–ª—å–∫–æ –ª–µ–≤–∞—è)
      if(a.hasR!==b.hasR) return a.hasR?1:-1;
      return 0;
    }

    // ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–¥–∞—á–∏ =====
    let deck, trump, L, R;
    let player, bot;
    let stage;      // 0: –∏–≥—Ä–æ–∫ —Ö–æ–¥–∏—Ç; 1: –∏–≥—Ä–æ–∫ –±—å—ë—Ç –∫–∞—Ä—Ç—É –±–æ—Ç–∞; 2: –∏–≥—Ä–æ–∫ –∫–ª–∞–¥—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é; -1: –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
    let tableCard;  // —Ç–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–∞ –Ω–∞ —Å—Ç–æ–ª–µ (–µ—ë –Ω—É–∂–Ω–æ –±–∏—Ç—å)

    // ===== UI =====
    const $ = s => document.querySelector(s);

    function log(msg){
      const box = $("#log");
      box.innerHTML += msg + "<br>";
      box.scrollTop = box.scrollHeight;
    }
    function setStatus(msg){ $("#status").textContent = msg; }
    function setBattle(msg){ $("#battle").textContent = msg || "–ü—É—Å—Ç–æ"; }
    function renderHands(){
      const p = $("#playerHand"); p.innerHTML="";
      player.forEach(c=>{
        const el = document.createElement("div");
        el.className = "card";
        el.textContent = c;
        // –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç–∞–¥–∏–∏
        if(stage===0 || stage===1 || stage===2){
          el.onclick = ()=>onPlayerClick(c);
        } else {
          el.classList.add("disabled");
        }
        p.appendChild(el);
      });
      $("#youCount").textContent = player.length;

      const b = $("#botHand"); b.innerHTML="";
      bot.forEach(()=> {
        const el = document.createElement("div");
        el.className = "card hide"; el.textContent="üÇ†";
        b.appendChild(el);
      });
      $("#botCount").textContent = bot.length;
    }

    // ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫—É–ª–∏—Å =====
    function startGame(){
      $("#table").style.display = "block";
      $("#log").innerHTML = ""; setBattle("–ü—É—Å—Ç–æ"); setStatus("");

      deck = makeDeck();
      shuffle(deck);

      trump = SUITS[Math.floor(Math.random()*SUITS.length)];
      L = leftPalka(trump); R = rightPalka(trump);

      $("#trump").textContent = trump;
      $("#leftPalka").textContent = L;
      $("#rightPalka").textContent = R;

      player = deck.slice(0,3);
      bot    = deck.slice(3,6);

      log("–ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∏–ª: " + player.join(", "));
      log("–ö–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–ª—É—á–∏–ª 3 –∫–∞—Ä—Ç—ã.");

      // –†–∞—Å–∫—Ä—ã—Ç–∏–µ –∫—É–ª–∏—Å–∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Ö–æ–¥–∞: —Ö–æ–¥ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–æ–∫ ‚Üí –æ–Ω —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–º
      const kP = detectKulis(player,trump);
      const kB = detectKulis(bot,trump);

      if(kP.exists){
        log(`üëâ –ò–≥—Ä–æ–∫ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫—É–ª–∏—Å (${kP.kind}, –æ—á–∫–æ–≤: ${sumPoints(player,trump)})`);
        if(kB.exists){
          log(`ü§ñ –ö–æ–º–ø—å—é—Ç–µ—Ä —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫—É–ª–∏—Å (${kB.kind}, –æ—á–∫–æ–≤: ${sumPoints(bot,trump)})`);
          const cmp = compareKulis(kP,kB);
          if(cmp>0){ endGame("–ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ –∫—É–ª–∏—Å—É."); return; }
          if(cmp<0){ endGame("–ö–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ –∫—É–ª–∏—Å—É."); return; }
          endGame("–ü–æ–ª–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –∫—É–ª–∏—Å–æ–≤ ‚Äî –Ω–∏—á—å—è."); return;
        } else {
          endGame("–ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ –∫—É–ª–∏—Å—É."); return;
        }
      } else {
        if(kB.exists){
          log(`ü§ñ –ö–æ–º–ø—å—é—Ç–µ—Ä —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫—É–ª–∏—Å (${kB.kind}, –æ—á–∫–æ–≤: ${sumPoints(bot,trump)})`);
          endGame("–ö–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ –∫—É–ª–∏—Å—É."); return;
        }
      }

      // –ö—É–ª–∏—Å–æ–≤ –Ω–µ—Ç ‚Äî –¥—É—ç–ª—å –Ω–∞ 3 –∫–∞—Ä—Ç—ã –ø–æ —Ç–≤–æ–µ–π —Å—Ö–µ–º–µ
      stage = 0; tableCard = null;
      setStatus("–•–æ–¥ –∏–≥—Ä–æ–∫–∞: –≤—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç—É –¥–ª—è –∞—Ç–∞–∫–∏.");
      renderHands(); renderBot();
    }

    function sumPoints(hand,tr){ return hand.reduce((s,c)=>s+kulisCardPoints(c,tr),0); }

    // ===== –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ =====
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

    // ===== –•–æ–¥ –∏–≥—Ä–æ–∫–∞ –∏ –∑–∞—â–∏—Ç–∞/–∞—Ç–∞–∫–∞ –±–æ—Ç–∞ =====
    function onPlayerClick(card){
      if(stage===0){
        // –ò–≥—Ä–æ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç: –∫–ª–∞–¥—ë—Ç –∫–∞—Ä—Ç—É
        playPlayerAttack(card);
      } else if(stage===1){
        // –ò–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–±–∏—Ç—å –∫–∞—Ä—Ç—É –±–æ—Ç–∞
        playPlayerDefense(card);
      } else if(stage===2){
        // –ò–≥—Ä–æ–∫ –∫–ª–∞–¥—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é
        playPlayerLast(card);
      }
    }

    function playPlayerAttack(card){
      removeFrom(player, card);
      tableCard = card;
      log("–ò–≥—Ä–æ–∫ —Ö–æ–¥–∏—Ç " + card);
      setBattle("–ù–∞ —Å—Ç–æ–ª–µ: " + tableCard);
      renderHands();
      setStatus("–ö–æ–º–ø—å—é—Ç–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–±–∏—Ç—å –∏ –ø–æ–¥–∫–∏–Ω—É—Ç—å.");
      setTimeout(botDefendAndAttack, 600);
    }

    function botDefendAndAttack(){
      // –ë–æ—Ç –∏—â–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—É—é –∫–∞—Ä—Ç—É –¥–ª—è –±–æ—è
      const defense = chooseMinDefense(bot, tableCard, trump);
      if(!defense){
        endGame("–ö–æ–º–ø—å—é—Ç–µ—Ä –Ω–µ —Å–º–æ–≥ –ø–æ–±–∏—Ç—å ‚Äî –ø–æ–±–µ–¥–∞ –∏–≥—Ä–æ–∫–∞!");
        return;
      }
      removeFrom(bot, defense);
      log("ü§ñ –ö–æ–º–ø—å—é—Ç–µ—Ä –±—å—ë—Ç " + tableCard + " –∫–∞—Ä—Ç–æ–π " + defense);

      // –ë–æ—Ç —Å—Ä–∞–∑—É –ø–æ–¥–∫–∏–¥—ã–≤–∞–µ—Ç —Å–≤–æ—é –∫–∞—Ä—Ç—É (–ª—É—á—à–µ —Å–ª–∞–±—É—é)
      const attack = chooseBotAttack(bot, trump);
      if(!attack){
        // –ù–µ –æ—Å—Ç–∞–ª–æ—Å—å –∫–∞—Ä—Ç ‚Äî –∏–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª (–±–æ—Ç –æ—Ç–±–∏–ª—Å—è, –Ω–æ –≤—ã—à–µ–ª –∏–∑ –∫–∞—Ä—Ç)
        endGame("–ö–æ–º–ø—å—é—Ç–µ—Ä –æ—Ç–±–∏–ª—Å—è, –Ω–æ —É –Ω–µ–≥–æ –∫–æ–Ω—á–∏–ª–∏—Å—å –∫–∞—Ä—Ç—ã ‚Äî –ø–æ–±–µ–¥–∞ –∏–≥—Ä–æ–∫–∞!");
        return;
      }
      removeFrom(bot, attack);
      tableCard = attack;
      log("ü§ñ –ö–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–¥–∫–∏–Ω—É–ª " + attack);
      setBattle("–ù–∞ —Å—Ç–æ–ª–µ: " + tableCard);
      renderHands();
      stage = 1;
      setStatus("–¢–≤–æ–π —Ö–æ–¥: –Ω—É–∂–Ω–æ –ø–æ–±–∏—Ç—å –∫–∞—Ä—Ç—É –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.");
    }

    function playPlayerDefense(card){
      if(!canBeat(tableCard, card, trump)){
        flashError(card); log("–≠—Ç–æ–π –∫–∞—Ä—Ç–æ–π –Ω–µ–ª—å–∑—è –ø–æ–±–∏—Ç—å."); return;
      }
      removeFrom(player, card);
      log("–ò–≥—Ä–æ–∫ –±—å—ë—Ç " + tableCard + " –∫–∞—Ä—Ç–æ–π " + card);
      tableCard = null; setBattle("–ü—É—Å—Ç–æ");
      renderHands();
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞—Ç–∞–∫–µ –∏–≥—Ä–æ–∫–∞
      stage = 2;
      if(player.length===0){
        // –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å (–ø–æ—Å–ª–µ –∑–∞—â–∏—Ç—ã –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è 1 –∫–∞—Ä—Ç–∞)
        endGame("–£ –∏–≥—Ä–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –∫–∞—Ä—Ç.");
        return;
      }
      setStatus("–ö–ª–∞–¥–∏ —Å–≤–æ—é –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç—É.");
    }

    function playPlayerLast(card){
      // –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ ‚Äî –∫–ª–∞–¥—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç—É
      if(player.length>1 && !player.includes(card)){ return; } // –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–æ–∫
      removeFrom(player, card);
      tableCard = card;
      log("–ò–≥—Ä–æ–∫ –∫–ª–∞–¥—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç—É " + card);
      setBattle("–ù–∞ —Å—Ç–æ–ª–µ: " + tableCard);
      renderHands();
      setStatus("–ö–æ–º–ø—å—é—Ç–µ—Ä –æ–±—è–∑–∞–Ω –æ—Ç–±–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞—Ä—Ç–æ–π.");
      setTimeout(botFinalDefend, 600);
    }

    function botFinalDefend(){
      const defense = chooseMinDefense(bot, tableCard, trump);
      if(!defense){
        endGame("–ö–æ–º–ø—å—é—Ç–µ—Ä –Ω–µ —Å–º–æ–≥ –ø–æ–±–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é ‚Äî –ø–æ–±–µ–¥–∞ –∏–≥—Ä–æ–∫–∞!");
        return;
      }
      removeFrom(bot, defense);
      log("ü§ñ –ö–æ–º–ø—å—é—Ç–µ—Ä –±—å—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é " + tableCard + " –∫–∞—Ä—Ç–æ–π " + defense);
      tableCard = null; setBattle("–ü—É—Å—Ç–æ");
      renderHands();

      // –ü–æ –ø—Ä–∞–≤–∏–ª–∞–º: –µ—Å–ª–∏ –∑–∞—â–∏—Ç–Ω–∏–∫ –æ—Ç–±–∏–ª—Å—è –¥–æ –∫–æ–Ω—Ü–∞ ‚Äî –æ–Ω –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç
      endGame("–ö–æ–º–ø—å—é—Ç–µ—Ä –æ—Ç–±–∏–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Äî –ø–æ–±–µ–¥–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.");
    }

    // ===== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ =====
    function chooseMinDefense(hand, atk, tr){
      // 1) –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ —Ç–æ–π –∂–µ –º–∞—Å—Ç–∏, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ; –∏–Ω–∞—á–µ 2) –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–∑—ã—Ä—å
      // –ï—Å–ª–∏ –∞—Ç–∞–∫–∞ ‚Äî –∫–æ–∑—ã—Ä—å, —Ç–æ –Ω—É–∂–µ–Ω —Å—Ç–∞—Ä—à–∏–π –∫–æ–∑—ã—Ä—å
      let options = hand.filter(c=>canBeat(atk,c,tr));
      if(options.length===0) return null;

      // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ ¬´–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π¬ª
      options.sort((a,b)=>{
        const aT = isTrump(a,tr), bT = isTrump(b,tr);
        const atkT = isTrump(atk,tr);
        if(atkT){
          // –æ–±–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–∑—ã—Ä—è–º–∏ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è trumpPower
          return trumpPower(a,tr) - trumpPower(b,tr);
        } else {
          // –ø—Ä–µ–¥–ø–æ—á–µ—Å—Ç—å –∫–∞—Ä—Ç—É —Ç–æ–π –∂–µ –º–∞—Å—Ç–∏, –∑–∞—Ç–µ–º –∫–æ–∑—ã—Ä–∏; –≤–Ω—É—Ç—Ä–∏ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ
          const aSame = a.slice(-1)===atk.slice(-1) && !isTrump(a,tr);
          const bSame = b.slice(-1)===atk.slice(-1) && !isTrump(b,tr);
          if(aSame!==bSame) return aSame? -1 : 1;
          // –µ—Å–ª–∏ –æ–±–∞ –∫–æ–∑—ã—Ä–∏ ‚Äî –ø–æ trumpPower
          if(aT && bT) return trumpPower(a,tr) - trumpPower(b,tr);
          // –æ–±–∞ —Ç–æ–π –∂–µ –º–∞—Å—Ç–∏ ‚Äî –ø–æ –æ–±—ã—á–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
          if(!aT && !bT) return NON_TRUMP_ORDER[a.slice(0,-1)] - NON_TRUMP_ORDER[b.slice(0,-1)];
          return 0;
        }
      });
      return options[0];
    }

    function chooseBotAttack(hand,tr){
      if(hand.length===0) return null;
      // –•–æ–¥–∏–º —Å–∞–º–æ–π —Å–ª–∞–±–æ–π, –∏–∑–±–µ–≥–∞—è —Ç—É–∑–æ–≤ –∏ –ø–∞–ª–æ–∫, –µ—Å–ª–∏ –º–æ–∂–µ–º
      const score = c=>{
        const t = isTrump(c,tr);
        const r = c.slice(0,-1);
        let base = t ? 100 + trumpPower(c,tr) : NON_TRUMP_ORDER[r];
        // penalize aces and palka to place them later
        if(r==="A") base += 20;
        if(isLeft(c,tr) || isRight(c,tr)) base += 15;
        return base;
      };
      const sorted = hand.slice().sort((a,b)=>score(a)-score(b));
      return sorted[0];
    }

    function removeFrom(arr, val){
      const i = arr.indexOf(val); if(i>=0) arr.splice(i,1);
    }

    function renderBot(){
      // —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã: —Å–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç—ã —É–∂–µ —Ä–∏—Å—É—é—Ç—Å—è
    }

    function endGame(msg){
      stage = -1;
      setStatus(msg);
      log("<b>"+msg+"</b>");
      tableCard = null; setBattle("–ü—É—Å—Ç–æ");
      // –±–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫–∏
      Array.from(document.querySelectorAll(".card")).forEach(el=>el.classList.add("disabled"));
    }

    function flashError(card){
      const els = Array.from(document.querySelectorAll("#playerHand .card"));
      const el = els.find(e=>e.textContent===card);
      if(!el) return;
      el.style.borderColor = "#ff4a4a";
      setTimeout(()=>{ el.style.borderColor="transparent"; }, 350);
    }
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö“Ø–ª—ñ—Å ‚Äî –ö–∞—Ä—Ç–æ—á–Ω—ã–π —Å—Ç–æ–ª</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: green;
      font-family: Arial, sans-serif;
    }

    #table {
      width: 900px;
      height: 600px;
      background: #2e7d32;
      border: 5px solid #1b5e20;
      border-radius: 12px;
      position: relative;
    }

    #player-hand, #opponent-hand {
      position: absolute;
      width: 100%;
      text-align: center;
    }

    #player-hand {
      bottom: 20px;
    }

    #opponent-hand {
      top: 20px;
    }

    .card {
      display: inline-block;
      width: 70px;
      height: 100px;
      background: white;
      border: 2px solid black;
      border-radius: 8px;
      margin: 5px;
      line-height: 100px;
      text-align: center;
      font-size: 22px;
      cursor: pointer;
    }

    #battlefield {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -200%);
      font-size: 26px;
      font-weight: bold;
      color: yellow;
      text-shadow: 2px 2px 4px black;
    }
  </style>
</head>
<body>
  <div id="table">
    <div id="opponent-hand"></div>
    <div id="battlefield"></div>
    <div id="player-hand"></div>
    <div id="message"></div>
  </div>

  <script>
    // ------------ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã ------------
    const suits = ["‚ô†", "‚ô£", "‚ô•", "‚ô¶"];
    const ranks = ["7", "9", "10", "J", "Q", "K", "A"];
    let deck = [];

    // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–ª–æ–¥—É (28 –∫–∞—Ä—Ç)
    for (let s of suits) {
      for (let r of ranks) {
        deck.push(r + s);
      }
    }

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
    deck = deck.sort(() => Math.random() - 0.5);

    // –†–∞–∑–¥–∞—á–∞
    let playerHand = deck.splice(0, 3);
    let opponentHand = deck.splice(0, 3);

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–∑—ã—Ä—å
    let trump = deck[0].slice(-1); // –º–∞—Å—Ç—å –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç—ã –æ—Å—Ç–∞–≤—à–µ–π—Å—è –∫–æ–ª–æ–¥—ã
    console.log("–ö–æ–∑—ã—Ä—å:", trump);

    // ------------ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ------------

    function getCardValue(card) {
      const r = card.slice(0, -1);
      const s = card.slice(-1);
      if (r === "7") return 7;
      if (["9"].includes(r)) return 9;
      if (["10", "J", "Q", "K"].includes(r)) return 10;
      if (r === "A") return 11;
      return 0;
    }

    function checkKulis(hand) {
      let suitsCount = {};
      hand.forEach(c => {
        let s = c.slice(-1);
        suitsCount[s] = (suitsCount[s] || 0) + 1;
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç—Ä–∏ —Ç—É–∑–∞ (—Å—Ç–∞—Ä—à–∏–π –∫—É–ª–∏—Å)
      if (hand.every(c => c[0] === "A")) return {score: 999, desc: "–¢—Ä–∏ —Ç—É–∑–∞"};

      // –ö—É–ª–∏—Å: –≤—Å–µ —Ç—Ä–∏ –æ–¥–Ω–æ–π –º–∞—Å—Ç–∏
      if (Object.values(suitsCount).includes(3)) {
        return {
          score: hand.reduce((a, c) => a + getCardValue(c), 0),
          desc: "–ö—É–ª–∏—Å –æ–¥–Ω–æ–π –º–∞—Å—Ç–∏"
        };
      }

      return null;
    }

    // ------------ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ ------------

    function renderHands() {
      const playerDiv = document.getElementById("player-hand");
      playerDiv.innerHTML = "";
      playerHand.forEach((card, i) => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerText = card;
        div.onclick = () => playCard(i, "player");
        playerDiv.appendChild(div);
      });

      const opponentDiv = document.getElementById("opponent-hand");
      opponentDiv.innerHTML = "";
      opponentHand.forEach((card, i) => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerText = "üÇ†"; // —Å–∫—Ä—ã—Ç—ã
        div.onclick = () => playCard(i, "opponent"); // —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
        opponentDiv.appendChild(div);
      });
    }

    function showMessage(text) {
      document.getElementById("message").innerText = text;
    }

    function playCard(index, who) {
      let card;
      if (who === "player") {
        card = playerHand.splice(index, 1)[0];
      } else {
        card = opponentHand.splice(index, 1)[0];
      }

      const battlefield = document.getElementById("battlefield");
      let div = document.createElement("div");
      div.className = "card";
      div.innerText = card;
      battlefield.appendChild(div);

      renderHands();

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—É–ª–∏—Å
      let kulis = who === "player" ? checkKulis([card, ...playerHand]) : checkKulis([card, ...opponentHand]);
      if (kulis) {
        showMessage((who === "player" ? "–ò–≥—Ä–æ–∫" : "–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫") + " –æ—Ç–∫—Ä—ã–ª " + kulis.desc + "! –ü–æ–±–µ–¥–∞!");
      }
    }

    renderHands();
  </script>
</body>
</html>
